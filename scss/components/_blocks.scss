$grids: 12;

/*----------------------------------
MIXINS
----------------------------------*/
//ROW
@mixin blocks($bp) {
  @include blocks-gap($bp, false);
  &.is-multi {
    @include blocks-gap($bp, true);
    > .block {
      @include block-gap($bp, true);
    }
  }
}

//ROW GAP
@mixin blocks-gap($bp, $multi) {
  &:not(.no-gap) {
    $gap: calc(-1 * var(--gap--#{$bp}));
    @if $multi {
      margin: $gap;
    } @else {
      margin-left: $gap;
      margin-right: $gap;
    }
  }
}

//COLUMN
@mixin block($bp) {
  @for $i from 1 through $grids {
    $className: null;
    @if ($bp==$default-breakpoint) {
      $className: is-#{$i};
    } @else {
      $className: #{$bp}--is-#{$i};
    }
    &.#{$className} {
      flex: 0 0 (100% / $grids) * $i;
      max-width: (100% / $grids) * $i;
    }
  }
}

//COLUMN GAP
@mixin block-gap($bp, $multi) {
  $gap: var(--gap--#{$bp});
  @if $multi {
    padding: $gap;
  } @else {
    padding-left: $gap;
    padding-right: $gap;
  }
}

//GRID
@mixin grid($bp) {
  @for $size from 1 through 12 {
    $className: null;
    @if ($bp==$default-breakpoint) {
      $className: is-#{$size};
    } @else {
      $className: #{$bp}--is-#{$size};
    }
    &.#{$className} {
      //Ocupies the space required for content.
      grid-template-columns: repeat($size, minmax(min-content, max-content));
      &.is-fluid {
        //Distributes across available space.
        grid-template-columns: repeat($size, 1fr);
      }
    }
  }
}

/*----------------------------------
CSS RULES
----------------------------------*/
.blocks {
  display: flex;
  flex-wrap: wrap;
  @include blocks($default-breakpoint);
  &.no-gap {
    > .block {
      padding-left: 0;
      padding-right: 0;
    }
  }
  &.is-middle {
    align-items: center;
  }
  @if ($debug) {
    border: 1px dotted red;
  }
}

.block {
  flex-basis: 0;
  flex-grow: 1;
  max-width: 100%;
  @include block($default-breakpoint);
  @include block-gap($default-breakpoint, false);
  @if ($debug) {
    border: 1px dotted blue;
  }
}

.grid {
  display: grid;
  gap: var(--gap--md);
  @include grid($default-breakpoint);
}

/*----------------------------------
MEDIA QUERIES
----------------------------------*/
@include loop-breakpoint() using ($bp) {
  .blocks {
    @include blocks($bp);
  }
  .block {
    @include block($bp);
    @include block-gap($bp, false);
  }
}
